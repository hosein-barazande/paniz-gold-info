<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ماشین‌حساب طلا و سکه</title>
<style>
  body {
    font-family: 'Vazir', Tahoma, sans-serif;
    direction: rtl;
    background: linear-gradient(180deg, #fff8e1, #fff);
    color: #333;
    margin: 0;
    padding: 0;
  }
  header {
    background: linear-gradient(90deg, #d4af37, #b8860b);
    color: #fff;
    text-align: center;
    padding: 15px 0;
    font-size: 1.3em;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  .container {
    max-width: 600px;
    margin: auto;
    padding: 15px;
  }
  .price-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    padding: 15px 20px;
    margin: 15px 0;
    transition: 0.3s;
  }
  .price-card:hover { transform: scale(1.02); }
  .price-item {
    display: flex;
    justify-content: space-between;
    border-bottom: 1px dashed #ddd;
    padding: 6px 0;
  }
  .analysis {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    padding: 15px 20px;
    margin-top: 25px;
  }
  .good { color: #388e3c; font-weight: bold; }
  .bad { color: #d32f2f; font-weight: bold; }
  .neutral { color: #f57c00; font-weight: bold; }
  .refresh-btn {
    display: block;
    width: 100%;
    background: linear-gradient(90deg, #d4af37, #b8860b);
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px;
    font-size: 1em;
    cursor: pointer;
    transition: 0.3s;
    margin-top: 20px;
  }
  .refresh-btn:hover {
    background: linear-gradient(90deg, #b8860b, #d4af37);
  }
  footer {
    text-align: center;
    color: #999;
    font-size: 0.8em;
    padding: 15px 0 30px;
  }
</style>
</head>
<body>

<header>📊 ماشین‌حساب لحظه‌ای طلا و سکه</header>

<div class="container">
  <div class="price-card">
    <h3>قیمت‌های لحظه‌ای</h3>
    <div class="price-item"><span>طلای ۱۸ عیار:</span> <span id="gold18">...</span></div>
    <div class="price-item"><span>طلای جهانی (اونس):</span> <span id="goldWorld">...</span></div>
    <div class="price-item"><span>سکه امامی:</span> <span id="sekeb">...</span></div>
    <div class="price-item"><span>سکه بهار آزادی:</span> <span id="bahar">...</span></div>
    <div class="price-item"><span>نیم سکه:</span> <span id="nim">...</span></div>
    <div class="price-item"><span>ربع سکه:</span> <span id="rob">...</span></div>
  </div>

  <div class="analysis">
    <h3>تحلیل امروز</h3>
    <p id="goldAnalysis">در حال دریافت اطلاعات...</p>
    <p id="coinAdvice"></p>
  </div>

  <button class="refresh-btn" onclick="getGoldData()">🔄 بروزرسانی دستی</button>

  <footer>© 2025 ماشین‌حساب طلا و سکه | حسین برازنده</footer>
</div>

<script>
// 🌐 آدرس API با استفاده از پراکسی برای دور زدن CORS
const apiUrl = "https://corsproxy.io/?https://api.tgju.org/v1/market/summary";

// 🎯 گرفتن المان‌ها از صفحه
const iranGoldElem = document.getElementById("iran-gold");
const worldGoldElem = document.getElementById("world-gold");
const coinListElem = document.getElementById("coins");
const suggestionElem = document.getElementById("suggestion");

// ⚙️ تابع اصلی برای دریافت داده‌ها
async function fetchGoldData() {
  try {
    // ⏳ دریافت داده‌ها از API
    const response = await fetch(apiUrl);
    const json = await response.json();

    const data = json.data;

    // 🟡 قیمت طلای ایران (۱۸ عیار)
    const iranGold = data["geram18"]["p"];
    iranGoldElem.textContent = `🟡 ${iranGold} تومان`;

    // 🌎 قیمت طلای جهانی (اونس)
    const worldGold = data["ons"]["p"];
    worldGoldElem.textContent = `🌍 ${worldGold} دلار`;

    // 💰 لیست سکه‌ها
    const coins = [
      { name: "سکه بهار آزادی", key: "sekebahar" },
      { name: "سکه امامی", key: "sekeemami" },
      { name: "نیم سکه", key: "nim" },
      { name: "ربع سکه", key: "rob" },
      { name: "سکه گرمی", key: "gerami" },
    ];

    // 🪙 نمایش قیمت سکه‌ها
    coinListElem.innerHTML = coins
      .map(c => {
        const coin = data[c.key];
        return `<li>💰 ${c.name}: ${coin ? coin.p + " تومان" : "❌ اطلاعات موجود نیست"}</li>`;
      })
      .join("");

    // 📊 محاسبه صرفه اقتصادی خرید طلا
    checkIfBuyingIsGood(parseFloat(iranGold.replace(/,/g, "")), parseFloat(worldGold.replace(/,/g, "")));

  } catch (err) {
    console.error("خطا در دریافت داده‌ها:", err);
    iranGoldElem.textContent = "⚠️ خطا در دریافت داده‌ها";
    worldGoldElem.textContent = "⚠️ خطا در دریافت داده‌ها";
    coinListElem.innerHTML = "<li>❌ امکان دریافت قیمت‌ها وجود ندارد.</li>";
    suggestionElem.textContent = "🚫 امکان محاسبه وجود ندارد.";
  }
}

// 📈 تابع محاسبه صرفه خرید طلا
function checkIfBuyingIsGood(iranPrice, worldPrice) {
  // 💵 هر اونس طلا ≈ 31.1035 گرم
  const worldPricePerGramDollar = worldPrice / 31.1035;

  // نرخ تقریبی دلار (قابل تغییر)
  const dollarRate = 60000;

  // 💰 قیمت هر گرم طلا در بازار جهانی به تومان
  const worldPricePerGramToman = worldPricePerGramDollar * dollarRate;

  // 🔍 اختلاف قیمت ایران با جهانی
  const diff = iranPrice - worldPricePerGramToman;
  const percent = (diff / worldPricePerGramToman) * 100;

  let suggestion = "";

  // 💡 تحلیل اقتصادی بر اساس اختلاف
  if (percent > 15) {
    suggestion = "🚫 در حال حاضر خرید طلا به صرفه نیست.";
  } else if (percent > 5) {
    suggestion = "⚠️ خرید طلا با احتیاط انجام شود.";
  } else {
    suggestion = "✅ زمان خوبی برای خرید طلا است!";
  }

  suggestionElem.textContent = suggestion;
}

// 🚀 اجرای اولیه و به‌روزرسانی هر ۲ دقیقه
fetchGoldData();
setInterval(fetchGoldData, 120000);

</script>

</body>
</html>
