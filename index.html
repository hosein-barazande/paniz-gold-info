<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>💰 قیمت لخضه ای طلا و سکه و ارزش خرید آنها</title>
<style>
  body {
    font-family: 'Vazir', Tahoma, sans-serif;
    direction: rtl;
    background: linear-gradient(180deg, #fff8e1, #fff);
    color: #333;
    margin: 0;
    padding: 0;
  }
  header {
    background: linear-gradient(90deg, #d4af37, #b8860b);
    color: #fff;
    text-align: center;
    padding: 15px 0;
    font-size: 1.3em;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  .container {
    max-width: 600px;
    margin: auto;
    padding: 15px;
  }
  .price-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    padding: 15px 20px;
    margin: 15px 0;
    transition: 0.3s;
  }
  .price-card:hover { transform: scale(1.02); }
  .price-item {
    display: flex;
    justify-content: space-between;
    border-bottom: 1px dashed #ddd;
    padding: 6px 0;
  }
  .analysis {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    padding: 15px 20px;
    margin-top: 25px;
  }
  .good { color: #388e3c; font-weight: bold; }
  .bad { color: #d32f2f; font-weight: bold; }
  .neutral { color: #f57c00; font-weight: bold; }
  .refresh-btn {
    display: block;
    width: 100%;
    background: linear-gradient(90deg, #d4af37, #b8860b);
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px;
    font-size: 1em;
    cursor: pointer;
    transition: 0.3s;
    margin-top: 20px;
  }
  .refresh-btn:hover {
    background: linear-gradient(90deg, #b8860b, #d4af37);
  }
  footer {
    text-align: center;
    color: #999;
    font-size: 0.8em;
    padding: 15px 0 30px;
  }
</style>
</head>
<body>

<header>📊 قیمت و ارزش خرید لحظه‌ای طلا و سکه</header>

<div class="container">
  <div class="price-card">
    <h3>💎 قیمت‌های لحظه‌ای</h3>
    <div class="price-item"><span>🟡 طلای ۱۸ عیار:</span> <span id="gold18">⏳</span></div>
    <div class="price-item"><span>🌍 طلای جهانی (اونس):</span> <span id="goldWorld">⏳</span></div>
    <div class="price-item"><span>🥇 سکه امامی:</span> <span id="sekeEmami">⏳</span></div>
    <div class="price-item"><span>🏅 سکه بهار آزادی:</span> <span id="sekeBahar">⏳</span></div>
    <div class="price-item"><span>🥈 نیم سکه:</span> <span id="nim">⏳</span></div>
    <div class="price-item"><span>🥉 ربع سکه:</span> <span id="rob">⏳</span></div>
  </div>

  <div class="analysis">
    <h3>📊 تحلیل امروز بازار</h3>
    <p id="goldAnalysis">در حال دریافت اطلاعات...</p>
    <p id="coinAdvice">💬 منتظر تحلیل...</p>
  </div>

  <button class="refresh-btn" onclick="getGoldData()">🔄 بروزرسانی دستی</button>

  <footer>© 2025 ماشین‌حساب طلا و سکه | digitizerco.net  💛</footer>
</div>

<script>
const apiUrl = "https://BrsApi.ir/Api/Market/Gold_Currency.php?key=BrTJ48gCdE4j5ayeWkHpr2VFTBEuR26Y"; 

// 🎯 گرفتن المان‌ها از صفحه
const gold18Elem = document.getElementById("gold18");
const goldWorldElem = document.getElementById("goldWorld");
const sekeEmamiElem = document.getElementById("sekeEmami");
const sekeBaharElem = document.getElementById("sekeBahar");
const nimElem = document.getElementById("nim");
const robElem = document.getElementById("rob");
const goldAnalysis = document.getElementById("goldAnalysis");
const coinAdvice = document.getElementById("coinAdvice");

// ⚙️ تابع اصلی دریافت داده‌ها
async function getGoldData() {
  try {
    goldAnalysis.textContent = "🔎 در حال دریافت اطلاعات...";

    const res = await fetch(apiUrl);
    const data = await res.json();

    // 🟡 گرفتن قیمت‌ها از آرایه gold
    const gold18 = data.gold.find(g => g.symbol === "IR_GOLD_18K").price;
    const worldGold = data.gold.find(g => g.symbol === "XAUUSD").price;
    const sekeEmami = data.gold.find(g => g.symbol === "IR_COIN_EMAMI").price;
    const sekeBahar = data.gold.find(g => g.symbol === "IR_COIN_BAHAR").price;
    const nim = data.gold.find(g => g.symbol === "IR_COIN_HALF").price;
    const rob = data.gold.find(g => g.symbol === "IR_COIN_QUARTER").price;

    // 💰 نمایش در صفحه
    gold18Elem.textContent = `🟡 ${gold18.toLocaleString()} تومان`;
    goldWorldElem.textContent = `🌍 ${worldGold.toLocaleString()} دلار`;
    sekeEmamiElem.textContent = `🥇 ${sekeEmami.toLocaleString()} تومان`;
    sekeBaharElem.textContent = `🏅 ${sekeBahar.toLocaleString()} تومان`;
    nimElem.textContent = `🥈 ${nim.toLocaleString()} تومان`;
    robElem.textContent = `🥉 ${rob.toLocaleString()} تومان`;

    // 📈 تحلیل خرید طلا
    analyzeGold(gold18, worldGold);

    // 💹 تحلیل حباب سکه
    analyzeCoin(sekeEmami, sekeBahar, nim, rob);

  } catch (err) {
    console.error("❌ خطا در دریافت داده‌ها:", err);
    gold18Elem.textContent = goldWorldElem.textContent = "⚠️ خطا در دریافت داده‌ها";
    sekeEmamiElem.textContent = sekeBaharElem.textContent = nimElem.textContent = robElem.textContent = "⚠️ خطا";
    goldAnalysis.textContent = "🚫 دریافت اطلاعات ممکن نیست!";
    coinAdvice.textContent = "🚫 امکان محاسبه وجود ندارد.";
  }
}

// 📊 تابع تحلیل خرید طلا
function analyzeGold(iranPrice, worldPrice) {
  const worldPricePerGramDollar = worldPrice / 31.1035; // هر اونس ≈ 31.1035 گرم
  const dollarRate = 60000; // نرخ دلار تقریبی
  const worldPricePerGramToman = worldPricePerGramDollar * dollarRate;

  const diff = iranPrice - worldPricePerGramToman;
  const percent = (diff / worldPricePerGramToman) * 100;

  if (percent > 15) {
    goldAnalysis.innerHTML = "🚫 خرید طلا به‌صرفه نیست (حباب بالا)";
    goldAnalysis.className = "bad";
  } else if (percent > 5) {
    goldAnalysis.innerHTML = "⚠️ خرید با احتیاط انجام شود (بازار ناپایدار)";
    goldAnalysis.className = "neutral";
  } else {
    goldAnalysis.innerHTML = "✅ زمان خوبی برای خرید طلا است!";
    goldAnalysis.className = "good";
  }
}

// 💡 تحلیل ساده حباب سکه‌ها
function analyzeCoin(emami, bahar, nim, rob) {
  const coins = [
    { name: "سکه امامی", value: emami, emoji: "🥇" },
    { name: "سکه بهار آزادی", value: bahar, emoji: "🏅" },
    { name: "نیم سکه", value: nim, emoji: "🥈" },
    { name: "ربع سکه", value: rob, emoji: "🥉" },
  ];

  // کمترین اختلاف = بهترین خرید
  const best = coins.reduce((a, b) => (a.value < b.value ? a : b));
  coinAdvice.innerHTML = `💰 بهترین گزینه امروز: <b>${best.emoji} ${best.name}</b> است.`;
}

// 🚀 اجرای اولیه + بروزرسانی خودکار هر ۲ دقیقه
getGoldData();
setInterval(getGoldData, 120000);
</script>


</body>
</html>
